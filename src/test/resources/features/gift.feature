Feature: 선물 API

  Scenario: 선물 전송 성공
    Given 이름이 "보내는사람" 이메일이 "sender@test.com"인 회원이 등록되어 있다
    And 이름이 "받는사람" 이메일이 "receiver@test.com"인 회원이 등록되어 있다
    And 이름이 "전자기기"인 카테고리가 등록되어 있다
    And 카테고리 "전자기기"에 이름 "노트북" 가격 1500000 이미지 "https://example.com/notebook.png"인 상품이 등록되어 있다
    And 상품 "노트북"에 이름 "기본 옵션" 재고 10인 옵션이 등록되어 있다
    When 회원 "보내는사람"이 회원 "받는사람"에게 옵션 "기본 옵션" 수량 3 메시지 "생일 축하해!"로 선물을 전송하면
    Then 응답 상태 코드는 200이다
    And 옵션 "기본 옵션"의 재고는 7이다

  Scenario: 선물 전송 실패 - 헤더 누락
    When Member-Id 헤더 없이 선물을 전송하면
    Then 응답 상태 코드는 400이다

  Scenario: 선물 전송 실패 - 존재하지 않는 옵션
    Given 이름이 "보내는사람" 이메일이 "sender@test.com"인 회원이 등록되어 있다
    When 회원 "보내는사람"이 존재하지 않는 옵션으로 선물을 전송하면
    Then 응답 상태 코드는 500이다

  Scenario: 선물 전송 실패 - 재고 부족
    Given 이름이 "보내는사람" 이메일이 "sender@test.com"인 회원이 등록되어 있다
    And 이름이 "받는사람" 이메일이 "receiver@test.com"인 회원이 등록되어 있다
    And 이름이 "전자기기"인 카테고리가 등록되어 있다
    And 카테고리 "전자기기"에 이름 "노트북" 가격 1500000 이미지 "https://example.com/notebook.png"인 상품이 등록되어 있다
    And 상품 "노트북"에 이름 "기본 옵션" 재고 2인 옵션이 등록되어 있다
    When 회원 "보내는사람"이 회원 "받는사람"에게 옵션 "기본 옵션" 수량 5 메시지 "선물"로 선물을 전송하면
    Then 응답 상태 코드는 500이다
    And 옵션 "기본 옵션"의 재고는 2이다

  Scenario: 선물 전송 실패 - 발신자 미존재
    Given 이름이 "받는사람" 이메일이 "receiver@test.com"인 회원이 등록되어 있다
    And 이름이 "전자기기"인 카테고리가 등록되어 있다
    And 카테고리 "전자기기"에 이름 "노트북" 가격 1500000 이미지 "https://example.com/notebook.png"인 상품이 등록되어 있다
    And 상품 "노트북"에 이름 "기본 옵션" 재고 10인 옵션이 등록되어 있다
    When 존재하지 않는 회원이 회원 "받는사람"에게 옵션 "기본 옵션" 수량 1 메시지 "선물"로 선물을 전송하면
    Then 응답 상태 코드는 500이다
    And 옵션 "기본 옵션"의 재고는 10이다
